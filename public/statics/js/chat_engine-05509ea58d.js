class ChatEngine{constructor(e,s,t){this.chatBox=$(`#${e}`),this.userEmail=s,this.user=t,this.socket=io.connect("http://127.0.0.1:5000"),this.userEmail&&this.connectionHandler()}connectionHandler(){let e=this;this.socket.on("connect",(function(){console.log("connection established using sockets...!")})),e.socket.emit("join_room",{user_email:e.userEmail,user:e.user,chatroom:"besocial"}),e.socket.on("user_joined",(function(s){if(s.user_email!=e.userEmail){$("#chat-messages-list").append(`<li class="joined">\n                                <span>\n                                    ${s.user} has joined!!!!!\n                                </span>\n                            </li>`)}$("#chat-messages-list").scrollTop($("#chat-messages-list").prop("scrollHeight"))}));let s=$("#chat-message-input-container");s.submit((function(t){t.preventDefault(),$.ajax({type:"post",url:s.prop("action"),data:s.serialize(),success:s=>{if(s.data.posted){let s=$("#chat-message-input").val();""!=s&&e.socket.emit("send_message",{message:s,user_email:e.userEmail,user:e.user,chatroom:"besocial"}),$("#chat-message-input").val(""),new Noty({theme:"relax",text:"chat posted",type:"success",layout:"topCenter",timeout:1500}).show()}},error:e=>{console.log(e.responseText)}})})),e.socket.on("receive_message",(function(s){let t=$("<li>"),a="other-message";s.user_email===e.userEmail&&(a="self-message"),t.append($("<span>",{html:s.message}));let n=(new Date).toLocaleString("default",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric"}),o=`\n                <div class="tag">\n                    <small>${s.user}</small>\n                    <small>${n}</small>\n                </div>\n            `;t.append(o),t.addClass(a),$("#chat-messages-list").append(t),$("#chat-messages-list").scrollTop($("#chat-messages-list").prop("scrollHeight"))}))}}